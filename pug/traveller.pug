extend default

//- Printable traveller.
//- Given:
//- A component w/data
//- A set of tests and/or jobs
//- Print it all out in something like a coherent fashon


include common.pug
include course-mixin.pug

mixin component_subdoc(component)
      -var componentUuid = component.componentUuid;
      h2
        =component.type + ": " + (component.data.name||component.componentUuid.substr(0,8))
      dl
        dt Component UUID
        dd
          a(href='/'+componentUuid)=componentUuid
        dt Version  #{component.validity.version}
        dd edited by !{' '}
          +short_user(component.insertion.user)
          | 
          | 
          | on #{moment(component.insertion.insertDate).format('MMMM Do YYYY, h:mm:ss a')}
        dd 
          a(href='/'+componentUuid+'/history') History
        dt Effective as of
        dd #{moment(component.validity.startDate).format('MMMM Do YYYY, h:mm:ss a')} (#{moment(component.validity.startDate).fromNow()})
      +createdFrom(component.createdFrom)
      .builtform.col-md-8(data-recordtype=component.recordType,data-record=component)

mixin test_subdoc(record)
    h3
      span.formName=record.formName || record.formId
      | (Test)
    .builtform.col-md-8(data-recordtype=record.recordType,data-record=record)


mixin job_subdoc(record)
    h3
      span.formName=record.formName || record.formId
      | (Workflow job)
    .builtform.col-md-8(data-recordtype=record.recordType,data-record=record)


mixin courseEvaluation_subdoc(record)
    h3 #{record.name} (Course)
    +evaluated-course(record,false)



mixin subdocument(record)
    if(record.recordType == "component") 
      +component_subdoc(record)
    if(record.recordType == "test") 
      +test_subdoc(record)
    if(record.recordType == "job") 
      +job_subdoc(record)
    if(record.recordType == "courseEvaluation") 
      +courseEvaluation_subdoc(record)



block vars
  - var page_title=(component||{}).name || componentUuid;

block extrascripts
  script(type='text/javascript',src='/page.js/traveller.js')

  style.
    div.section { 
      break-before: page;
      break-inside: avoid-page; 
      }


block allbody
  .container-fluid
    div.section
      div.float-right#qr-code.col-md-4
        +qr-panel(base_url+'/'+component.componentUuid.toString(),component.data.name)
      h1 #{component.type}: #{component.data.name}
      h3 #{componentUuid}
      h3 Traveller
      +subdocument(records[0])

    each record in records.slice(1)
      div.section
        +subdocument(record)

