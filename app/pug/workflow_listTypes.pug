extend default
include common.pug

block vars
  - const page_title = 'All Workflow Types';

block extrascripts
  block workscripts
    script(src = '/pages/workflow_listTypes.js')

block content
  .container-fluid
    div.vert-space-x2
      a(href = '#', data-toggle = 'modal' data-target = '#NewTypeModal').btn.btn-warning
        img.small-icon(src = '/images/edit_icon.svg')
        | &nbsp; Create New Workflow Type Form

      #NewTypeModal.modal.fade(tabindex = '-1' role = 'dialog' aria-labelledby = 'NewTypeLabel' aria-hidden = 'true')
        .modal-dialog(role = 'document')
          .modal-content
            .modal-header
              h5#NewTypeLabel.modal-title Create New Workflow Type Form
              button.close(type = 'button', data-dismiss = 'modal', aria-label = 'Close')
                span(aria-hidden = 'true') &times;
            .modal-body
              div
                | Enter the new workflow type form ID.
                br
                | NOTE: this ID must have only underscores and alphanumerics (no spaces, hyphens or special characters).  A human-readable name can be set on the next page.
              div.vert-space-x1
                input.form-control#formId(type = 'text')
            .modal-footer
              button.btn.btn-danger(type = 'button', data-dismiss = 'modal') Close
              button.btn.btn-success#NewTypeButton(type = 'button') Create

    div.vert-space-x2
      h2 Available Workflow Types

    div.vert-space-x1
      table.table
        thead
          tr
            th.col-md-2 Type ID
            th.col-md-2 Type Name
            th.col-md-2 Recommended Component Types
            th.col-md-2 Short Description
            th.col-md-2
            th.col-md-2

        tbody
          each typeFormId in Object.keys(workflowTypeForms).sort()
            - const typeForm = workflowTypeForms[typeFormId];

            if(typeForm.tags && !typeForm.tags.includes('Trash')) 
              tr
                td #{typeFormId}
                td
                  a(href = `/workflows/${typeFormId}/list`) #{typeForm.formName}

                if((typeForm.componentTypes) && (typeForm.componentTypes.length > 0))
                  td 
                    +arrayFormat(typeForm.componentTypes)
                else
                  td (none)

                td #{typeForm.description}
                td
                  a(href = `/workflow/${typeFormId}`).btn-sm.btn-primary 
                    img.small-icon(src = '/images/run_icon.svg')
                    | &nbsp; Create a New Workflow of this Type
                td
                  a(href = `/workflowTypes/${typeFormId}/edit`).btn-sm.btn-warning 
                    img.small-icon(src = '/images/edit_icon.svg')
                    | &nbsp; Edit Workflow Type Form

    if(permissions.userHas(user, 'forms:edit'))
      div.vert-space-x2
        h2 Trashed Workflow Types

      div.vert-space-x1
        table.table
          thead
            tr
              th.col-md-2 Type ID
              th.col-md-2 Type Name
              th.col-md-3 Recommended Component Types
              th.col-md-2 Short Description
              th.col-md-2

          tbody
            each typeFormId in Object.keys(workflowTypeForms).sort()
              - const typeForm = workflowTypeForms[typeFormId];

              if(typeForm.tags && typeForm.tags.includes('Trash')) 
                tr
                  td #{typeFormId}  
                  td
                    a(href = `/workflows/${typeFormId}/list`) #{typeForm.formName}

                  if(typeForm.componentTypes.length > 0)
                    td
                      +arrayFormat(typeForm.componentTypes)
                  else
                    td (none)

                  td #{typeForm.description}
                  td
                    a(href = `/workflowTypes/${typeFormId}/edit`).btn-sm.btn-warning 
                      img.small-icon(src = '/images/edit_icon.svg')
                      | &nbsp; Edit Workflow Type Form

    div.vert-space-x2
